services:
  jenkins:
    image: jenkins/jenkins:jdk21
    container_name: jenkins-pipeline
    restart: unless-stopped
    ports:
      # Map the container's 8080 port to the host's 1080 port
      - "1080:8080"
    environment:
      # CRITICAL CONFIGS FOR CSRF FIX:
      # 1. Set the exact URL you use to access Jenkins in your browser
      JENKINS_URL: http://localhost:1080/  
    networks:
      - jenkins-net
    volumes:
      - jenkins_home:/var/jenkins_home
  ssh-agent:
    image: jenkins/ssh-agent
    networks:
      - jenkins-net
  mailhog:
    image: nfqlt/mailhog:arm64
    restart: unless-stopped   
    ports:
    - "1090:80" # mailhog's web app (think test instance of gmail)
    #- "1025:1025" # jenkins will use `mailhog:1025` to send emails, only map to host if you want to send files:

    networks:
      - jenkins-net

volumes:
  jenkins_home:

networks:
  jenkins-net:
    driver: bridge
  